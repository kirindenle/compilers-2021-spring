-- States: partial maps from variables into values

-- Empty state (undefined everywhere)
public fun emptyState (x) {
  failure ("undefined variable ""%s""\n", x)
}

-- Putting a binding into a state
public infix <- before : (st, [x, v]) {
  -- printf("adding %s = %s\n", x.string, v.string);
  fun (y) {
    -- printf("reading %s\n", y.string);
    if compare (x, y) == 0 then v else st (y) fi
  }
}
